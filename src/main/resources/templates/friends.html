<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Friends</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <link rel="stylesheet" href="/main.css">

</head>
<body>
<!-- HEADER -->
<div th:replace="~{fragments :: header}"></div>

<div class="layout-container">
    <!-- LEFT SIDEBAR -->
    <div th:replace="~{fragments :: left-sidebar}"></div>

    <main class="main-content">
        <div class="main-inner">
    <!--Search bar pop up-->
            <div id="search-error" th:if="${searchError}"
                 style="position: absolute; top: 235px; right: 295px;
                        color: black; font-size: 0.9rem; font-weight: bold;
                        background: rgba(255,255,255,0.95); padding: 5px 10px;
                        border: 1px solid #ccc; border-radius: 4px;
                        opacity: 1; transition: opacity 1s ease;">
                <span th:text="${searchError}"></span>
            </div>

            <!--Search bar for friends-->
            <form action="/friends/search" method="get" style="text-align: right; margin-top: 30px; padding-right: 20px;">
                <input
                        type="text"
                        name="query"
                        placeholder="Search for your friends by email or surname"
                        style="padding: 10px; width: 300px; border: 1px solid #ccc; border-radius: 4px;"
                        required
                />
                <button type="submit" style="padding: 10px 20px; margin-left: 15px; font-weight:bold; background-color: #1877f2; color: white; border: none; border-radius: 5px;">
                    Search
                </button>
            </form>


            <!-- Auto-hide script -->
            <script>
                window.addEventListener('DOMContentLoaded', () => {
                  const errorDiv = document.getElementById('search-error');
                  if (errorDiv) {
                    setTimeout(() => {
                      errorDiv.style.opacity = '0';
                      setTimeout(() => {
                        errorDiv.style.display = 'none';
                      }, 1000); // wait for fade-out to complete
                    }, 3000); // delay before fading starts
                  }
                });
            </script>

            <!-- Friend requests section -->
            <h1>Friend Requests</h1>
            <ul th:if="${incomingRequests}">
                <li th:each="request : ${incomingRequests}">
                    <span th:text="${request.sender.forename + ' ' + request.sender.surname}"></span>
                    <form th:action="@{/friend-requests/accept}" method="post" style="display:inline;">
                        <input type="hidden" name="requestId" th:value="${request.id}" />
                        <button type="submit">Accept</button>
                    </form>
                    <form th:action="@{/friend-requests/decline}" method="post" style="display:inline;">
                        <input type="hidden" name="requestId" th:value="${request.id}" />
                        <button type="submit">Decline</button>
                    </form>
                </li>
            </ul>
            <p th:if="${#lists.isEmpty(incomingRequests)}">You currently have no friend requests.</p>

            <!-- My Friends section -->
            <div id="friends-list" class="friends box">
                <h1 th:text="'Friends (' + ${friendsCount} + ')'" id="friends">Friends</h1>
                <ul class="friends-grid">
                    <li class="friend-card" th:each="friend : ${friends}">
                        <a class="friend-link" th:href="@{/profile/{id}(id=${friend.id})}">
                            <div class="friend-avatar">
                                <img class="profile-friend-avatar"
                                     th:src="@{${friend.profile_image_src}}"
                                     alt="Friend's profile picture"
                                     onerror="this.onerror=null; this.src='/assets/default-profile.png'" />
                            </div>
                            <div class="friend-info">
                                <span class="friend-name" th:text="${friend.forename + ' ' + friend.surname}">Name</span>
                            </div>
                        </a>
                    </li>
                </ul>
            </div>

        </div>
    </main>
    <!-- RIGHT SIDEBAR -->
    <div th:replace="~{fragments :: right-sidebar}"></div>
</div>

<!-- FOOTER -->
<div th:replace="~{fragments :: footer}"></div>

</body>
</html>
